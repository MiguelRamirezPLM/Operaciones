@model IEnumerable<GuiaNet.Models.plm_vwProductsByClientRegisterandBarcode>
@using GuiaNet.Models;
@{
    ViewBag.Title = "Index";
    WebGrid _datagrid = new WebGrid(Model, rowsPerPage: 20);
    Guia db = new Guia();
    sessionmedicalproducts ind = (sessionmedicalproducts)Session["sessionmedicalproducts"];
    int ClientIdss, EditionIds, BookIds, CountryIdss;
    if (ind != null)
    {
        ClientIdss = ind.ClId;
        EditionIds = ind.EId;
        BookIds = ind.BId;
        CountryIdss = ind.CId;
    }
    else
    {
        ClientIdss = 0;
        EditionIds = 0;
        BookIds = 0;
        CountryIdss = 0;
    }
}

<html>
<head>
    <title></title>

    @*UPDATE PRODUCT FIELDS*@
    <script type="text/javascript">
        $(function () {
            $(".edit-mode").hide();
            $(".edit-user, .cancel-user").click(function (evento) {
                var tr = $(this).parents("tr:first");
                tr.find(".edit-mode, .display-mode").toggle();
            });

            $(".save-user").click(function (e) {
                var tr = $(this).parents("tr:first");
                var name = tr.find("#Name").val();
                var descript = tr.find("#Description").val();
                var register = tr.find("#Register").val();
                var ID = tr.find("#lblProductid").val();
                var Country = $("#CountryId").val();
                var Div = $("#DivisionIdN").val();
                var barc = tr.find("#barcode").val();
                var barcid = tr.find("#lblBarCodeId").val();
                var client = $("#ClientId").val();
                var pharmaf = tr.find("#lblPharmaformid").val();
                var active = tr.find("#lblActivesubstanceid").val();
                var present = tr.find("#lblPresentationid").val();
                //tr.find("#lblName").text(name);
                //tr.find("#lblDescription").text(descript);
                //tr.find("#lblRegister").text(register);
                if ((!name.trim() == true) && (!register.trim() == true) && (!barc.trim() == true)) {
                    apprise("<div align='center'><img src='../Images/alerta.png' /> </div>" + "<li> Ningun campo puede quedar vacío </li>", { 'animate': true });
                }
                else {
                    $("#bloqueo").show();

                    var ProductName = (name);
                    var Description = (descript);
                    var RegisterP = (register);
                    var ProdID = (ID);
                    var CID = (Country);
                    var Division = (Div);
                    var App = 0;
                    var User = 0;
                    var d = "";
                    d += "<div align='center'><img src='../Images/alerta.png' /> </div>";

                    $.ajax({
                        type: "POST",
                        dataType: "Json",
                        url: "../MedicalProducts/editproducts/",
                        traditional: true,
                        data: { PName: ProductName, ProductId: ProdID, regist: RegisterP, Clientid: client, BarCode: barc, BarCodeId: barcid, pform: pharmaf, substance: active, presentation: present },
                        success: function (data) {
                            if (data != true) {
                                d += "<li>Verificar El Código de Barras, Ya Existe!!!</li>"
                                d += "<p></p>"
                                d += "<p style='width:300px;text-align:justify;color:#05606d;font-style:italic'>El Código es: " + data + " </p>"
                                apprise("" + d + "", { 'animate': true });
                            }
                            else {
                                setTimeout('document.location.reload()');
                            }
                        }
                    })
                }
                $("#bloqueo").hide();
            });
        });
    </script>
    @*END*@

    @*INSERT NEW PRODUCT*@
    <script type="text/javascript" src="@Url.Content("~/Scripts/apprise-1.5.min.js")"></script>
    <link rel="stylesheet" href="~/Content/apprise.min.css" type="text/css" />
    <script type="text/javascript">
        $(function () {
            $(".submit").click(function () {
                var prodname = $("#productname").val();
                var country = $("#CountryId").val();
                var pharmaform = $(".pharmaform").val();
                var presentation = $(".presentation").val();
                var activesubstance = $(".activesubstance").val();
                var edition = $("#EditionId").val();
                var client = $("#ClientId").val();
                var nulls = $(".null").val();
                var register = $("#register").val();
                var barcod = $("#barcode").val();
                var d = "";
                d += "<div align='center'><img src='../Images/alerta.png' /> </div>";
                if (country == null) {
                    apprise("<div align='center'><img src='../Images/alerta.png' /> </div>" + "Falta seleccionar País,Laboratorio y Edición", { 'animate': true });
                }
                else {
                    if ((!prodname.trim() == false) && (pharmaform != nulls) && (presentation != 0) && (activesubstance != nulls)) {
                        $.ajax({
                            url: "../MedicalProducts/createnewproduct/",
                            type: "POST",
                            dataType: "json",
                            data: { ProductN: prodname, pharmaformid: pharmaform, presentationid: presentation, activesubstanceid: activesubstance, editionid: edition, clientid: client, registers: register, barcode: barcod },
                            success: function (data) {

                                if (data == true) {
                                    setTimeout('document.location.reload()');
                                }
                                if (data == false) {
                                    d += "<li>El Producto Ya Existe para este Cliente!!!</li>"
                                    apprise("" + d + "", { 'animate': true });
                                }
                            },
                        });
                    }
                    else {
                        if (!prodname.trim() == true) {
                            d += "<div><li> Falta Nombre de Producto</div>";
                        }
                        if (pharmaform == nulls) {
                            d += "<div><li> Falta Forma Farmacéutica</div>";
                        }
                        if (presentation == 0) {
                            d += "<div><li> Falta Presentación</div>";
                        }
                        if (activesubstance == nulls) {
                            d += "<div><li> Falta Sustancia Activa</div>";
                        }
                        apprise("" + d + "", { 'animate': true });
                    }
                }
            })
        })
    </script>
    @*END*@

    @**INSERT INTO PARTICIPANTPRODUCTS*@
    <script>
        $(document).ready(function () {
            $(".Participant").click(function () {
                var tr = $(this).parents("tr:first");
                if (tr.find(".Participant").is(':checked')) {
                    var prodId = tr.find("#lblProductid").val();
                    var client = $("#ClientId").val();
                    var edition = $("#EditionId").val();
                    var pharmaform = tr.find("#lblPharmaformid").val();
                    var activesubstance = tr.find("#lblActivesubstanceid").val();
                    var presentation = tr.find("#lblPresentationid").val();
                    tr.find("#lblProductid").text(prodId);
                    var App = 0;
                    var User = 0;
                    $("#bloqueo").show();
                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        url: "../MedicalProducts/insertparticipantproducts/",
                        traditional: true,
                        data: { productid: prodId, clientid: client, editionid: edition, pharmaformid: pharmaform, activesubstanceid: activesubstance, presentationid: presentation },
                        success: function (data) {
                        }
                    });
                }
                else if (tr.find(".Participant").is(":not(:checked)")) {

                    var prodId = tr.find("#lblProductid").val();
                    var client = $("#ClientId").val();
                    var edition = $("#EditionId").val();
                    var pharmaform = tr.find("#lblPharmaformid").val();
                    var activesubstance = tr.find("#lblActivesubstanceid").val();
                    var presentation = tr.find("#lblPresentationid").val();
                    tr.find("#lblProductid").text(prodId);
                    $("#bloqueo").show();
                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        url: "../MedicalProducts/deleteparticipantproducts/",
                        traditional: true,
                        data: { ProductId: prodId, clientid: client, editionid: edition, pharmaformid: pharmaform, activesubstanceid: activesubstance, presentationid: presentation },
                        success: function (data) {
                        }
                    });
                }
                $("#bloqueo").hide();
            });
        });
    </script>
    @*END*@

    <link href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" rel="Stylesheet">
    <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script>
        $(function () {
            var Country = $("#CountryId").val();
            $("#productname").autocomplete({
                appendTo: $("#productname").parent(),
                source: function (request, response) {
                    $.ajax({
                        url: "../MedicalProducts/searchpredictive/",
                        type: "POST",
                        dataType: "json",
                        data: { term: request.term, country: Country },
                        success: function (data) {
                            response($.map(data, function (item) {
                                return { label: item, value: item };
                            }))
                        }
                    })
                },
                minLength: 3
            });
        });
    </script>

    <script>
        $(function () {
            $("#addpresentation").click(function () {
                $("#textarea").show();
                $("#addpresentation").hide();
                $("#cancelpresentation").show();
            });
        });
    </script>
    <script>
        $(function () {
            $("#cancelpresentation").click(function () {
                $("#textarea").hide();
                $("#addpresentation").show();
                $("#cancelpresentation").hide();
                $("#insertpresentation").val('');
            });
        });
    </script>
    @*  CREATE NEW PRESENTATION *@
    <script>
        $(function () {
            $("#btnds").click(function () {
                var presentation = $("#insertpresentation").val();
                var d = "";
                d += "<div align='center'><img src='../Images/alerta.png' /> </div>";
                if (!presentation.trim() == true) {
                    apprise("<div align='center'><img src='../Images/alerta.png' /> </div>" + "El campo NO pruede quedar vacío!!!", { 'animate': true });
                }
                else {
                    $.ajax({
                        url: "../MedicalProducts/createnewpresentation/",
                        type: "POST",
                        dataType: "json",
                        data: { Description: presentation },
                        success: function (data) {
                            if (data == true) {
                                $("#insertpresentation").val('');
                                $("#textarea").hide();
                                $("#addpresentation").hide();
                                $("#cancelpresentation").hide();
                                $.ajax({
                                    type: "POST",
                                    dataType: "json",
                                    url: "../MedicalProducts/getpresentation/",
                                    traditional: true,
                                    success: function (data) {
                                        console.log(data);
                                        $('#presentation').empty();
                                        $('#presentation')
                                           .append($("<option></option>")
                                           .attr("value", 0)
                                           .text("Seleccione..."));
                                        $.each(data, function (index, val) {
                                            $('#presentation')
                                            .append($("<option></option>")
                                            .attr("value", val.PresentationId)
                                            .text(val.Description));
                                        });
                                    }
                                });
                            }
                            if (data != true) {
                                d += "<li> La Presentacíon ya existe, el Nombre es: </li>"
                                d += "<p></p>"
                                d += "<p style='width:300px;text-align:justify;color:#05606d;font-style:italic'>" + data + "</p>"
                                apprise("" + d + "", { 'animate': true });
                            }
                        },
                    });
                }
            });
        });
    </script>
    @*  END   *@
    <script>
        $(document).ready(function () {
            $(function () {
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: "../MedicalProducts/getpresentation/",
                    traditional: true,
                    success: function (data) {
                        $('#presentation').empty();
                        $('#presentation')
                           .append($("<option></option>")
                           .attr("value", 0)
                           .text("Seleccione..."));
                        $.each(data, function (index, val) {
                            $('#presentation')
                            .append($("<option></option>")
                            .attr("value", val.PresentationId)
                            .text(val.Description));
                        });
                    }
                });
            })
        })
    </script>
</head>
<body>
    <br />
    <div id="insertproductsH" style="display: none;">
        <div class="content-popup">
            <div class="close"><a href="#" id="close" onclick="close_popup_createproductH();"><img src="~/images/cancel.png" style="float: right; width: 30px; height: 30px;" /></a></div>
            <div>
                <h2 class="classh2" style="color: #345869">Agregar Producto</h2>
                <br />
                <table style="width:100%" border="0">
                    <tr style="line-height: 40px;">
                        <td style="width: 30%; font-size: 16px; text-align: left"><label class="labelsform">Nombre de Producto:</label></td>
                        <td style="width:30px"></td>
                        <td><input type="text" class="form-control" id="productname" /></td>
                    </tr>
                    <tr style="line-height: 40px;">
                        <td style="width: 30%; font-size: 16px; text-align: left"><label class="labelsform">Forma Farmacéutica:</label></td>
                        <td style="width:30px"></td>
                        <td>
                            <select class="form-control pharmaform" id="pharmaform">
                                <option>Seleccione...</option>
                                @{
                                    var pharmaf = (from pform in db.PharmaceuticalForms
                                                   orderby pform.PharmaForm ascending
                                                   select pform).ToList();
                                    foreach (PharmaceuticalForms pf in pharmaf)
                                    {
                                        <option value="@pf.PharmaFormId">@pf.PharmaForm</option>
                                    }
                                }
                            </select>
                        </td>
                    </tr>
                    <tr style="line-height: 40px;">
                        <td style="width: 30%; font-size: 16px; text-align: left"><label class="labelsform">Presentación:</label></td>
                        <td style="width:30px"></td>
                        <td>
                            <select class="form-control presentation" id="presentation"></select>
                        </td>

                        <td>
                            @{
                                sessionmedicalproducts indd = (sessionmedicalproducts)Session["sessionmedicalproducts"];
                                if (indd != null)
                                {
                                    <img src="@Url.Content("~/Images/expand.png")" style="height:30px;width:30px" id="addpresentation">
                                    <img src="@Url.Content("~/Images/contract.png")" style="height:30px;width:30px;display:none" id="cancelpresentation">
                                }
                            }
                        </td>
                    </tr>
                    <tr style="display:none;line-height:40px" id="textarea">
                        <td colspan="4" style="text-align:center">

                            <label style="height: 35px;border-radius:10px; width: 100%; background-color: #2e4a4f;color:white">Agregar Nueva Presentación</label><br />
                            <textarea style="font-size: 12px; width: 100%;border-radius:10px" id="insertpresentation"></textarea>
                            <p style="text-align:center;height:25px">
                                <button type="submit" id="btnds" value="Insertar" class="btnds btn btn-info" style="color: #333; font-size: 17px; width: 45px; height: 35px">
                                    <img src="@Url.Content("~/Images/save.png")" style="height:25px;width:20px;">
                                </button>
                            </p>
                            <br />
                        </td>
                    </tr>
                    <tr style="line-height: 40px;">
                        <td style="width:30%; font-size:16px;text-align:left"><label class="labelsform">Sustancia Activa:</label> </td>
                        <td style="width:30px"></td>
                        <td>
                            <select class="form-control activesubstance">
                                <option>Seleccione...</option>
                                @{
                                    var substance = (from sa in db.ActiveSubstances
                                                     orderby sa.ActiveSubstance ascending
                                                     select sa);
                                    foreach (ActiveSubstances _as in substance)
                                    {
                                        <option value="@_as.ActiveSubstanceId">@_as.ActiveSubstance</option>
                                    }
                                }
                            </select>

                        </td>
                    </tr>
                    <tr style="line-height: 40px;display:normal">
                        <td style="width:35%; font-size:16px;text-align:left"><label class="labels">Registro Sanitario:</label></td>
                        <td style="width:30px"></td>
                        <td><input type="text" class="form-control" id="register" /></td>
                    </tr>
                    <tr style="line-height: 40px; display: normal">
                        <td style="width:35%; font-size:16px;text-align:left"><label class="labels">Código de Barras:</label></td>
                        <td style="width:30px"></td>
                        <td><input type="text" class="form-control" id="barcode" /></td>
                    </tr>
                    <tr style="line-height: 40px;">
                        <td style="height:1px;text-align:center" colspan="4">
                            <p style="text-align:center;height:25px"> <button type="submit" id="Insert" value="Insertar" class="submit btn btn-info" style="color: #333; font-size: 17px; width: 85px; height: 35px">Insertar</button></p>
                        </td>
                    </tr>
                    <tr>
                        <td style="height: 25px"></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <table border="0" style="width:100%; height:100%">
        <tr>
            <td colspan="4">
                <button style="float:right" id="" class="btn btn-info menul" onclick="location.href='@Url.Action("Index", "Help", new { module = "SM" })';return false;">Ayuda</button>
                <ol class="breadcrumb">
                    <li><a href="/SalesModule/Index">Ventas</a></li>
                    <li class="active">Productos Hospitalarios</li>
                </ol>
            </td>
        </tr>
        <tr>
            <td colspan="3">
                @using (Html.BeginForm())
                {
                    <div style="text-align:right;display:none">
                        <p>
                            @{
                                if (ind != null)
                                {
                                    <label>country</label><input id="CountryId" name="CountryId" type="text" value="@ind.CId">
                                            <label>book</label><input id="BookId" name="BookId" type="text" value="@ind.BId">
                                            <label>edition</label><input id="EditionId" name="EditionId" type="text" value="@ind.EId">
                                            <label>client</label><input id="ClientId" name="ClientId" type="text" value="@ind.ClId">
                                            <button type="submit" id="InsertParam" value="GridView" class="btn btn-primary" style="color: #333; width: 50px; font-size: 18px"></button>
                                }
                                else
                                {
                                    <label>country</label><input id="CountryId" name="CountryId" type="text" value="">
                                            <label>book</label><input id="BookId" name="BookId" type="text" value="">
                                            <label>edition</label><input id="EditionId" name="EditionId" type="text" value="">
                                            <label>client</label><input id="ClientId" name="ClientId" type="text" value="">
                                            <button type="submit" id="InsertParam" value="GridView" class="btn btn-primary" style="color: #333; width: 50px; font-size: 18px"><img src="@Url.Content("~/Images/buscar.png")" style=" height:30px;width:30px;"></button>
                                }
                            }
                        </p>
                    </div>
                }
                @{
                    if (ind == null)
                    {
                        <div style="width: 100%; float: left">
                            <table style="width:100%" border="0">
                                <tr>
                                    <td width="100px">
                                        <label class="lblcountrywhite">País:</label><label style="color:red;float:right;font-size:20px">*</label>
                                    </td>
                                    <td style="line-height: 30px;width:15px"></td>
                                    <td style="line-height: 30px;">
                                        <div style="text-align:left;">
                                            @using (Html.BeginForm())
                                            {
                                                <select name="pais" id="pais" onchange="getbook($(this).val());" class="country form-control" style="text-align: left; width: 100%; font-size: 12px; height: 30px;">
                                                    <option class="null">Seleccione...</option>
                                                    @{
                                                CountriesUsers p = (CountriesUsers)Session["CountriesUsers"];
                                                if (Session["CountriesUsers"] == null)
                                                {
                                                    Session.Abandon();
                                                    Response.Redirect(Url.Action("Logout", "Login"));
                                                    Response.End();
                                                }
                                                else if (p != null)
                                                {
                                                    List<string> d = p.var;
                                                    foreach (var f in d)
                                                    {
                                                        var countries = (from country in db.Countries
                                                                         where country.ID == f
                                                                         select country);
                                                        foreach (Countries w in countries)
                                                        {
                                                            int CountryId = w.CountryId;
                                                            <option class="search" id="Country" value="@w.CountryId">@w.CountryName </option>
                                                        }
                                                    }
                                                }
                                                    }
                                                </select>
                                            }
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="line-height: 30px;">
                                        <label for="bookname" id="lblbook" style="display:normal">Obra:</label><label style="color:red;float:right;font-size:20px" id="lblbook1">*</label>

                                    </td>
                                    <td style="line-height: 30px;width:15px"></td>
                                    <td style="line-height: 30px;">
                                        <select name="book" id="bookn" class="insert form-control" onchange="geteditions($(this).val());" style="text-align: left; display: normal; width: 100%; font-size: 12px; height: 30px"></select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="line-height: 30px;">
                                        <label for="Edition" id="lblEdition" style="display: normal">Edición:</label><label style="color:red;float:right;font-size:20px" id="lblEdition1">*</label>
                                    </td>
                                    <td style="line-height: 30px;width:15px"></td>
                                    <td style="line-height: 30px;">
                                        <select name="Edition" id="Edition" class="insert form-control" onchange="getclients($(this).val());" style="text-align: left; display: normal; width: 100%; font-size: 12px; height: 30px"></select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="line-height: 30px;">
                                        <label for="DivisionName" id="lblclient" style="display: normal">Cliente:</label><label style="color:red;float:right;font-size:20px" id="lblclient1">*</label>
                                    </td>
                                    <td style="line-height: 30px;width:15px"></td>
                                    <td style="line-height: 30px;">
                                        <select name="clients" id="clients" class="insert form-control" onchange="getresults($(this).val());" style="text-align: left; display: normal; width: 100%; font-size: 12px; height: 30px"></select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div style="width: 100%;">
                            <table style="width:100%" border="0">
                                <tr>
                                    <td width="100px">
                                        <label class="lblcountrywhite">País:</label><label style="color:red;float:right;font-size:20px">*</label>
                                    </td>
                                    <td style="line-height: 30px;width:15px"></td>
                                    <td style="line-height: 30px;">
                                        <div style="text-align:left;">
                                            @using (Html.BeginForm())
                                            {
                                                <select name="pais" id="pais" onchange="getbook($(this).val());" class="country form-control" style="text-align: left; width: 100%; font-size: 12px; height: 30px;">
                                                    <option class="null">Seleccione...</option>
                                                    @{
                                                CountriesUsers p = (CountriesUsers)Session["CountriesUsers"];
                                                if (Session["CountriesUsers"] == null)
                                                {
                                                    Session.Abandon();
                                                    Response.Redirect(Url.Action("Logout", "Login"));
                                                    Response.End();
                                                }
                                                else if (p != null)
                                                {
                                                    List<string> d = p.var;
                                                    foreach (var f in d)
                                                    {
                                                        var countries = (from country in db.Countries
                                                                         where country.ID == f
                                                                         select country);
                                                        foreach (Countries w in countries)
                                                        {
                                                            int CountryId = ind.CId;
                                                            if (w.CountryId == CountryId)
                                                            {
                                                                <option class="search" id="Country" selected="selected" value="@w.CountryId">@w.CountryName </option>
                                                            }
                                                            else
                                                            {
                                                                <option class="search" id="Country" value="@w.CountryId">@w.CountryName </option>
                                                            }

                                                        }
                                                    }
                                                }
                                                    }
                                                </select>
                                            }
                                        </div>
                                    </td>
                                    <td rowspan="4" style="text-align:right"></td>
                                    <td rowspan="4" style="text-align:center">
                                        <button class="btn btn-info" onclick="open_popup_createproductH()">Agregar Producto.</button>
                                    </td>
                                    <td rowspan="4">
                                        <a target="_blank" href="@Url.Action("GetReportMedicalProductsbyClient", "GetReports", new { id = "PDF" })"><img src="@Url.Content("~/Images/pdfmedicalproducts.png")" style="height:85px;width:85px"></a>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="line-height: 30px;">
                                        <label for="bookname" id="lblbook" style="display:normal">Obra:</label><label style="color:red;float:right;font-size:20px;" id="lblbook1">*</label>
                                    </td>
                                    <td style="line-height: 30px;width:15px"></td>
                                    <td style="line-height: 30px; height: 30px">
                                        <select name="book" id="bookn" class="insert form-control" onchange="geteditions($(this).val());" style="text-align: left; display: normal; width: 100%; font-size: 12px; height: 30px">
                                            <option>Seleccione...</option>
                                            @{
                                            int BookId = ind.BId;

                                            var bk = (from book in db.Books
                                                      where book.BookId == BookId
                                                      select book).ToList();
                                            foreach (Books _book in bk)
                                            {
                                                if (_book.BookId == BookId)
                                                {
                                                    <option value="@_book.BookId" selected="selected">@_book.BookName</option>
                                                }
                                                else
                                                {
                                                    <option value="@_book.BookId">@_book.BookName</option>
                                                }
                                            }
                                            }
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="line-height: 30px;">
                                        <label for="Edition" id="lblEdition" style="display: normal">Edición:</label><label style="color:red;float:right;font-size:20px" id="lblEdition1">*</label>
                                    </td>
                                    <td style="line-height: 30px;width:15px"></td>
                                    <td style="line-height: 30px;">
                                        <select name="Edition" id="Edition" class="insert form-control" onchange="getclients($(this).val());" style="text-align: left; display: normal; width: 100%; font-size: 12px; height: 30px">
                                            <option>Seleccione...</option>
                                            @{
                                            int EditionId = ind.EId;
                                            int CountryIds = ind.CId;
                                            var ed = (from _ed in db.Editions
                                                      where _ed.CountryId == CountryIds
                                                      select _ed).ToList();

                                            foreach (Editions _ed in ed)
                                            {
                                                if (_ed.EditionId == EditionId)
                                                {
                                                    <option value="@_ed.EditionId" selected="selected">@_ed.NumberEdition</option>
                                                }
                                                else
                                                {
                                                    <option value="@_ed.EditionId">@_ed.NumberEdition</option>
                                                }
                                            }
                                            }
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="line-height: 30px;">
                                        <label for="DivisionName" id="lblclient" style="display: normal">Cliente:</label><label style="color:red;float:right;font-size:20px" id="lblclient1">*</label>
                                    </td>
                                    <td style="line-height: 30px;width:15px"></td>
                                    <td style="line-height: 30px;">
                                        <select name="clients" id="clients" class="insert form-control" onchange="getresults($(this).val());" style="text-align: left; display: normal; width:100%; font-size: 12px; height: 30px">
                                            <option>Seleccione...</option>
                                            @{
                                            byte clienttypeid = 0;
                                            var ct = (from clientt in db.ClientTypes
                                                      where clientt.TypeName == "ANUNCIANTE"
                                                      select clientt).ToList();
                                            foreach (ClientTypes _ct in ct)
                                            {
                                                clienttypeid = _ct.ClientTypeId;
                                            }

                                            var _clients = (from c in db.Clients
                                                            join ec in db.EditionClients
                                                            on c.ClientId equals ec.ClientId
                                                            where ec.ClientTypeId == clienttypeid
                                                            && c.CountryId == CountryIdss
                                                            orderby c.CompanyName ascending
                                                            select c).Distinct().OrderBy(x => x.CompanyName).ToList();
                                            foreach (Clients c in _clients)
                                            {
                                                <option value="@c.ClientId">@c.CompanyName</option>
                                            }
                                            }
                                        </select>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    }
                }
            </td>
        </tr>
        <tr>
            <td colspan="3"><label></label></td>
        </tr>
        @{
            if (ind != null)
            {
                <tr>
                    <td style="width: 10%;"><label class="labels">País:</label></td>
                    <td style="width: 1%;"></td>
                    <td>
                        @{
                var cts = (from _ct in db.Countries
                           where _ct.CountryId == CountryIdss
                           select _ct).ToList();
                foreach (Countries _ct in cts)
                {
                    <label>@_ct.CountryName</label>
                }
                        }
                    </td>
                </tr>
                <tr>
                    <td style="width:10%"><label class="labels">Libro:</label></td>
                    <td style="width:1%"></td>
                    <td>
                        @{
                var bks = (from _bk in db.Books
                           where _bk.BookId == BookIds
                           select _bk).ToList();
                foreach (Books _bks in bks)
                {
                        <label>@_bks.BookName</label>
                }
                        }
                    </td>
                </tr>
                <tr>
                    <td style="width:10%"><label class="labels">Edición:</label></td>
                    <td></td>
                    <td>
                        @{
                var eds = (from _ed in db.Editions
                           where _ed.EditionId == EditionIds
                           select _ed).ToList();
                foreach (Editions _eds in eds)
                {
                        <label>@_eds.NumberEdition</label>
                }
                        }
                    </td>
                </tr>
                <tr>
                    <td style="width:10%"><label class="labels">Cliente:</label></td>
                    <td style="width:1%"></td>
                    <td>
                        @{
                var cl = (from _cl in db.Clients
                          where _cl.ClientId == ClientIdss
                          select _cl).ToList();
                foreach (Clients _cl in cl)
                {
                        <label>@_cl.CompanyName</label>
                }
                        }
                    </td>
                </tr>
            }
        }
        <tr>
            <td colspan="3" style="text-align:right">
                @{
                    if (ind != null)
                    {
                        using (Html.BeginForm("searchproduct", "MedicalProducts"))
                        {
                            <label>Buscar Producto:&nbsp;</label>  @Html.TextBox("ProductName", "", new { @class = "form-focus" })
                            <button type="submit" id="searchp" value="searchprod" class="btn btn-info searchoproducts" style="color: #333; width: 40px; font-size: 18px"><img src="@Url.Content("~/Images/buscar.png")" style=" height:20px;width:20px;"></button>
                        }
                    }
                }
                <br />
            </td>
        </tr>
    </table>

    <div style="border-radius:10px;width:100%">
        @_datagrid.GetHtml(
                          headerStyle: "webgrid-header1",
                          footerStyle: "webgrid-footer",
                          alternatingRowStyle: "webgrid-alternating-row",
                          selectedRowStyle: "webgrid-selected-row",
                          rowStyle: "webgrid-row-style",
                          tableStyle: "webgrid-table ",
                          mode: WebGridPagerModes.All,
                          columns: new[] {
                          _datagrid.Column("", header: "Nombre de Producto", format: @<text>
                                @{
                                    <span class="display-mode"> <label id="lblName" style="width:120px">@item.ProductName</label> </span>
                                    <textarea style="display:none;  color:red; font-size: 12px;" maxlength="200" id="Name" class="edit-mode edprod form-control">@item.ProductName</textarea>
                                    <input id="lblProductid" style="display:none; width:20px" value="@item.ProductId" />
                                }
                        </text>,style:"columntablelt"),
         _datagrid.Column("", header: "Forma Farmacéutica", format: @<text>
            @{
                <span> <label id="lblName" style="width:150px">@item.PharmaForm</label> </span>
                <input id="lblPharmaformid" style="display:none; width:20px" value="@item.PharmaFormId" />
            }
        </text>,style:"columntablelt"),
         _datagrid.Column("", header: "Sustancia Activa", format: @<text>
            @{
                <span> <label id="lblName" style="width:120px;text-align:justify">@item.ActiveSubstance</label> </span>
                <input id="lblActivesubstanceid" style="display:none; width:20px" value="@item.ActiveSubstanceId" />
            }
        </text>,style:"columntablelt"),
          _datagrid.Column("", header: "Presentación", format: @<text>
            @{
                <span> <label id="lblName">@item.Description</label> </span>
                <input id="lblPresentationid" style="display:none; width:20px" value="@item.PresentationId" />
            }
        </text>,style:"columntable200"),


        _datagrid.Column("", header: "Registro Sanitario", format: @<text>
            @{
                <span class="display-mode"> <label id="lblregister">@item.RegisterSanitary</label> </span>
    <textarea style="display:none;  color:red; font-size: 12px;" maxlength="200" id="Register" class="edit-mode edreg form-control">@item.RegisterSanitary</textarea>
                <input id="lblProductid" style="display:none; width:20px" value="@item.ProductId" />
            }
        </text>,style:"columntable150"),

                      _datagrid.Column("", header: "Codigo de Barras", format: @<text>
            @{
                <span class="display-mode"> <label id="lblbarcode">@item.BarCode</label> </span>
    <textarea style="display:none;  color:red; font-size: 12px;" maxlength="200" id="barcode" class="edit-mode barcode form-control">@item.BarCode</textarea>
                <input id="lblBarCodeId" style="display:none; width:20px" value="@item.BarCodeId" />
            }
                    </text>,style:"columntable150"),


              _datagrid.Column("", header: "Participante", format: @<text>
            @{
                sessionmedicalproducts sessionmp = (sessionmedicalproducts)Session["sessionmedicalproducts"];
                if(sessionmp != null)
                {
                int editionid = sessionmp.EId;
                int productid = item.ProductId;
                int clientid = sessionmp.ClId;
                int PharmaFormId = item.PharmaFormId;
                int ActiveSubstance = item.ActiveSubstanceId;
                int PresentationId = item.PresentationId;
                var pp = (from edition in db.EditionClientMedicalProducts
                          where edition.EditionId == editionid
                          && edition.ProductId == productid
                          && edition.ClientId == clientid
                          && edition.PharmaFormId == PharmaFormId
                          && edition.PresentationId == PresentationId
                          && edition.ActiveSubstanceId == ActiveSubstance
                          select edition).ToList();

                         bool participant = false;
                         foreach (EditionClientMedicalProducts p in pp)
                         {
                             if ((@item.ProductId == p.ProductId) && (@item.PharmaFormId == p.PharmaFormId) && (@item.ActiveSubstanceId == p.ActiveSubstanceId) && (@item.PresentationId == p.PresentationId))
                             {
                                 participant = true;
                             }
                         }
                    <input type="checkbox" class="Participant" checked="@participant" />
                }
            }
            </text>,style:"columncenter column5"),
                                  _datagrid.Column("", header: "Editar", format: @<text>
            @{
                <button style="color: #333; width: 45px;height:35px" class="edit-user display-mode btn btn-info"><img src="@Url.Content("~/Images/edit.png")" style="height:25px;width:25px;"></button>
                <button style="color: #333; display: none; width: 45px; height: 35px; " class="save-user edit-mode btn btn-warning" value="@item.ProductName"><img src="@Url.Content("~/Images/save.png")" style="height:25px;width:20px;"></button>
                <button style="color: #333; display: none; width: 45px; height: 35px; " class="cancel-user edit-mode btn btn-warning"><img src="@Url.Content("~/Images/cancel.png")" style="height:25px;width:20px;"></button>
            }
                                </text>,style:"columncenter column10"),
        })
    </div>
</body>
</html>
