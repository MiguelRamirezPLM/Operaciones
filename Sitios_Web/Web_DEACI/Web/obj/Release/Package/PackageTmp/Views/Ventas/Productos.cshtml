<link href="~/Styles/Ventas_Productos.css" rel="stylesheet" />
@{
    SessionCompanyEditions _Session1 = (SessionCompanyEditions)Session["SessionCompanyEditions"];
}
@{
    SessionEditionId pp = (SessionEditionId)Session["SessionEditionId"];
}
<script src="~/Scripts/ProductScripts.js"></script>
@model PagedList.IPagedList<Web.Models.Union_Products>
@using Web.Models;
@using PagedList.Mvc;
@{
    ViewBag.Title = "Productos del cliente";
    PLMUsers plm = new PLMUsers();
    DEACI_20150917Entities db = new DEACI_20150917Entities();
}
<link href="~/Content/PagedList.css" rel="stylesheet" />
<div class="container center col-lg-10" align="center">
    <div class="row" align="center">
        <div align="center">
            <button type="button" class="btn btn-default3 navbar-default btn-nav ribbon Estilo3"> Ventas</button>
        </div>
    </div>
    <table class="table table-hover table-bordered">
        <tr>
            <td width="182" align="center" class="warning Estilo4 btn-nav">
                <div>
                    <div align="right">País:</div>
                </div>
            </td>
            <td width="950" align="center" class=" Estilo4 btn-nav">
                <div>
                    <div align="left"> @ViewData["País"]</div>
                </div>
            </td>
        </tr>
        <tr>
            <td width="182" align="center" class="warning Estilo4 btn-nav">
                <div>
                    <div align="right">Obra:</div>
                </div>
            </td>
            <td width="950" align="center" class=" Estilo4 btn-nav">
                <div>
                    <div align="left">@ViewData["Obra"]</div>
                </div>
            </td>
        </tr>
        <tr>
            <td width="182" align="center" class="warning Estilo4 btn-nav">
                <div>
                    <div align="right">Edición:</div>
                </div>
            </td>
            <td width="950" align="center" class=" Estilo4 btn-nav">
                <div>
                    <div align="left">@ViewData["Edición"]</div>
                </div>
            </td>
        </tr>
        <tr>
            <td width="182" align="center" class="warning Estilo4 btn-nav">
                <div>
                    <div align="right">Tipo de cliente:</div>
                </div>
            </td>
            <td width="950" align="center" class=" Estilo4 btn-nav">
                <div>
                    <div align="left">@ViewData["TipoCliente"]</div>
                </div>
            </td>
        </tr>
    </table>
</div>
<div>
    <nav class="navbar navbar-default Estilo7 container center col-lg-10">
        <div class="container-fluid">
            <div class="navbar-header">
                <ul class="nav navbar-nav">
                    <li><a class="carga" href="/Ventas/Clientes/@ViewData["Number"]/@ViewData["CompanyId"]/@_Session1._CompanyTypeId"><strong class="Estilo6 btn-nav">Cliente: @ViewData["CompanyName"] <span class="sr-only">(current)</span></strong> </a></li>
                </ul>
            </div>
        </div>
    </nav>
</div>
<div>
    <nav class="navbar navbar-default Estilo4 container center col-lg-10">
        <div class="container-fluid">
            <div class="navbar-header">
                <input type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <a href="/FiltroVentas/Pais" class="btn navbar-brand  carga" title="Inicio">
                    <i class="glyphicon glyphicon-home Estilo8"></i>
                </a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li class="dropdown navbar-default">
                        <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Ediciones<span class="caret"></span></a>
                        <ul class="dropdown-menu" role="menu">
                            <li>
                                <div id="custom-search-input">
                                    <div class="input-group col-md-11">
                                        <input id="CaracterEdiciones" type="text" class="form-control btn-nav" placeholder="Buscar" />
                                        <span class="input-group-btn">
                                            <button class="btn btn-info" type="button">
                                                <i class="glyphicon glyphicon-search"></i>
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <p> </p>
                            </li>
                            @{
                                var _EditionSelected = (from _e in db.Editions
                                                        select _e).ToList();
                                foreach (var a in _EditionSelected)
                                {
                                    <li class="ListaEdiciones"><a class="carga" href="/Ventas/Productos/@a.EditionId/@_Session1.ed/@_Session1._CompanyTypeId">@a.NumberEdition</a></li>
                                }
                            }
                        </ul>
                    </li>
                    <li class="dropdown  navbar-default">
                        <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Clientes<span class="caret"></span></a>
                        <ul class="dropdown-menu v" role="menu">
                            <li>
                                <div id="custom-search-input">
                                    <div class="input-group col-md-11">
                                        <input id="Caracter" type="text" class="form-control btn-nav" placeholder="Buscar" />
                                        <span class="input-group-btn">
                                            <button class="btn btn-info" type="button">
                                                <i class="glyphicon glyphicon-search"></i>
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <p> </p>
                            </li>
                            @{
                                var _storeprocedure = db.Database.SqlQuery<plm_spGetCompaniesByEditionIdByCompanyTypeId_Result>
                                    ("plm_spGetCompaniesByEditionIdByCompanyTypeId @EditionId=" + _Session1.id + ", @CompanyTypeId=" + _Session1._CompanyTypeId + "").ToList();
                            }
                            @foreach (var a in _storeprocedure)
                            {
                                <li class="ListaClientes"><a class="carga" href="/Ventas/Productos/@ViewData["Number"]/@a.CompanyId/@a.CompanyTypeId">@a.CompanyName</a></li>
                            }
                        </ul>
                    </li>
                    <li><a class="carga" href="/Ventas/Marcas/@ViewData["Number"]/@ViewData["CompanyId"]/@_Session1._CompanyTypeId">Marcas <span class="sr-only">(current)</span></a></li>
                    <li class="dropdown active  navbar-default">
                        <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Productos<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a data-toggle="modal" data-target="#AgregarProductoId">Agregar producto</a></li>
                        </ul>
                    </li>
                    <li><a class="carga" href="/Ventas/Distribuidores/@ViewData["Number"]/@ViewData["CompanyId"]/@_Session1._CompanyTypeId">Distribuidores <span class="sr-only">(current)</span></a></li>
                    @*<li><a class="carga" href="/Ventas/Secciones/@ViewData["Number"]/@ViewData["CompanyId"]/@_Session1._CompanyTypeId">Secciones <span class="sr-only">(current)</span></a></li>*@
                    @*<li><a class="carga" href="/Ventas/Ediciones/@ViewData["Number"]/@ViewData["CompanyId"]">Ediciones <span class="sr-only">(current)</span></a></li>*@
                </ul>
                <form class="navbar-form navbar-left Estilo4" role="search">
                    <div class="form-group  Estilo4">
                        @Html.TextBox("palabra", null, new { @class = "form-control btn-nav" })
                    </div>
                    <input type="submit" class="btn btn-primary" value="Buscar">
                </form>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a class="btn navbar-brand " title="Anterior" onclick="history.back();">
                            <i class="glyphicon glyphicon-chevron-left Estilo6"></i>
                        </a>
                        <a class="btn navbar-brand" title="Siguiente" onclick="history.forward();">
                            <i class="glyphicon glyphicon-chevron-right Estilo6"></i>
                        </a>
                    </li>
                    @{
                        CountriesUsers p = (CountriesUsers)Session["CountriesUsers"];
                        var _RolesA = (from _us in plm.Users
                                       join _ap in plm.ApplicationUsers
                                       on _us.UserId equals _ap.UserId
                                       join _r in plm.Roles
                                       on _ap.RoleId equals _r.RoleId
                                       where _us.UserId == p.userId
                                       select _r);
                        if (_RolesA.FirstOrDefault().Description == "Administrador")
                        {
                            @*<li class="dropdown">
                                    <a class="dropdown-toggle" data-toggle="dropdown">
                                        <span class="glyphicon glyphicon glyphiconr glyphicon-bookmark Estilo8"></span> Ventas <b class="caret"></b>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a class="carga" href="/FiltroVentas/Pais"><span class="glyphicon glyphicon glyphiconr glyphicon-share-alt"></span>Módulo de ventas</a></li>
                                    </ul>
                                </li>*@
                            <li class="dropdown">
                                <a class="dropdown-toggle" data-toggle="dropdown">
                                    <span class="glyphicon glyphicon glyphiconr glyphicon-ruble Estilo8"></span> Producción <b class="caret"></b>
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="carga" href="/Producción/AsociarProductos/@_Session1.id/@_Session1.ed/@_Session1._CompanyTypeId"><span class="glyphicon glyphicon glyphiconr glyphicon-share-alt"></span>Módulo de producción</a></li>
                                </ul>
                            </li>
                        }
                    }
                </ul>
            </div>
        </div>
    </nav>
</div>

<div class="blockscreen" id="cargando">
    <div id="blockmessage">
        <h3 style="color:#000" class="TextBlock">  Cargando... </h3>
    </div>
    <div id="blockimg">
        <img src="/Images/ldd.gif">
    </div>
</div>


@{
    var _CompanyClose = (from _ce in db.CompanyEditions
                         where _ce.CompanyId == _Session1.ed
                         && _ce.EditionId == _Session1.id
                         select _ce).ToList();
    if (_CompanyClose.LongCount() == 0)
    {
        <div align="center" class="container center col-lg-10 Estilo7">
            <input type="hidden" id="_Edition_Client_Participant" value="@_Session1.id"/>
            <input type="hidden" id="_Client_Participant" value="@_Session1.ed" />
            <input type="hidden" id="_Client_Type_Participant" value="@_Session1._CompanyTypeId" />
    El cliente <strong class="Estilo6">@ViewData["CompanyName"]</strong> aún no participa en la edición <strong class="Estilo6">@ViewData["Edición"],</strong> si quiere que sea participante en la edición de click <a class="Cliente_Participante">aqui</a>
        </div>
    }
    foreach (var Close in _CompanyClose)
    {
        if (Close.CloseClient == false)
        {
            <div align="center" class="container center col-lg-10 Estilo7">
                El cliente <strong class="Estilo6">@ViewData["CompanyName"]</strong> ya esta cerrado para la edición <strong class="Estilo6">@ViewData["Edición"].</strong>
            </div>
        }
        else
        {
             <div class="container center col-lg-10">
    <div class="row" align="center">
        <div align="center">
            <button type="button" class="btn btn-default2 navbar-default  btn-nav ribbon Estilo7">Productos del cliente</button>
        </div>
    </div>
    <table class="table table-hover table-bordered">
        <tr>
            <td class="warning Estilo4" align="center">
                <div>
                    <div align="left">Nombre del producto</div>
                </div>
            </td>
            <td class="warning Estilo4" align="center">
                <div>
                    <div align="center">Tipo de producto</div>
                </div>
            </td>
            <td class="warning Estilo4" align="center">
                <div>
                    <div align="center">Participante</div>
                </div>
            </td>
            <td class="warning Estilo4" align="center">
                <div>
                    <div align="center">N.</div>
                </div>
            </td>
            <td class="warning Estilo4" align="center">
                <div>
                    <div align="center">C.C</div>
                </div>
            </td>
            <td class="warning Estilo4" align="center">
                <div>
                    <div align="center">S.C.</div>
                </div>
            </td>
            <td width="100" class="warning Estilo4" align="center">
                <div>
                    <div align="center">Editar</div>
                </div>
            </td>
            <td width="100" class="warning Estilo4" align="center">
                <div>
                    <div align="center">Información</div>
                </div>
            </td>
            <td width="100" class="warning Estilo4" align="center">
                <div>
                    <div align="center">Secciones</div>
                </div>
            </td>
            <td width="100" class="warning Estilo4" align="center">
                <div>
                    <div align="center">Índices</div>
                </div>
            </td>
            <td width="150" class="warning Estilo4" align="center">
                <div>
                    <div align="center">Ediciones</div>
                </div>
            </td>
        </tr>
        @foreach (var c in Model)
        {
            var _n = c.prod.ProductId + 10000;
            var _m = c.prod.ProductId + 20000;
            var _r = c.prod.ProductId + 30000;
            <tr>
                <td class="Estilo2 btn-nav">
                    @Html.DisplayFor(modelItem => c.prod.ProductName)
                </td>
                <td class="Estilo2 btn-nav" align="center">
                    @Html.DisplayFor(model => c.prodtypes.Description)
                </td>
                <td align="center" class="Estilo2 btn-nav">
                    @{

            int _EditionId = pp.id;
            <input type="hidden" value="@_EditionId" id="_EditionId" />
            int _CompanyId = pp.ed;
            var _ProductEditions = (from _pe in db.ProductEditions
                                    join _p in db.Products
                                    on _pe.ProductId equals _p.ProductId
                                    where _pe.EditionId == pp.id
                                    && _p.CompanyId == _CompanyId
                                    select _pe).ToList();
            bool _Checado = false;
            foreach (ProductEditions _pr in _ProductEditions)
            {
                if (c.prod.ProductId == _pr.ProductId)
                {
                    _Checado = true;
                }
            }
                    }
                    Edición @ViewData["Edición"]
                    <input type="checkbox" id="@c.prod.ProductId" value="@c.prod.ProductId" name="ProductEditions" class="Producto_Participante" checked="@_Checado">
                </td>
                <td align="center" class="Estilo2 btn-nav">
                    @{
            <input type="hidden" value="@_EditionId" id="_EditionId" />
            var _ProductStatus = (from _pe in db.ProductEditions
                                    join _p in db.Products
                                    on _pe.ProductId equals _p.ProductId
                                    join _s in db.Status
                                    on _pe.StatusId equals _s.StatusId
                                    where _pe.EditionId == pp.id
                                    && _p.CompanyId == _CompanyId
                                    && _s.Description == "Nuevo"
                                    select _s).ToList();
            bool _CheckStatus = false;
            foreach (Status _pr in _ProductStatus)
            {
                var _StatusId = (from _s in db.Status
                                 join _pe in db.ProductEditions
                                 on _s.StatusId equals _pe.StatusId
                                 where _pe.ProductId == c.prod.ProductId
                                 && _pe.EditionId == _EditionId
                                 select _s).ToList();
                foreach (var stat in _StatusId)
                {
                    if (stat.StatusId == _pr.StatusId)
                    {
                        _CheckStatus = true;
                    }
                }
            }
            var _ProductEditionsValue = (from _pe in db.ProductEditions
                                    where _pe.EditionId == _EditionId
                                    && _pe.ProductId == c.prod.ProductId
                                    select _pe).ToList();
            if (_ProductEditionsValue.LongCount() == 0)
            {
             @*<input disabled type="checkbox" id="@c.prod.ProductId" value="@c.prod.ProductId" name="Producto_Nuevo" class="Producto_Nuevo" checked="@_CheckStatus">*@
            }
            else
            {
             <input hidden value="@_ProductEditionsValue.SingleOrDefault().EditionId" id="_EditionIdNew" />
             <input type="checkbox" id="@c.prod.ProductId" value="@c.prod.ProductId" name="Producto_Nuevo" class="Producto_Nuevo" checked="@_CheckStatus"> 
            }

                                                        }
                </td>
                <td align="center" class="Estilo2 btn-nav">
                    @{
                        <input type="hidden" value="@_EditionId" id="_EditionId" />
            var _ProductStatusCambios = (from _pe in db.ProductEditions
                                  join _p in db.Products
                                  on _pe.ProductId equals _p.ProductId
                                  join _s in db.Status
                                  on _pe.StatusId equals _s.StatusId
                                  where _pe.EditionId == pp.id
                                  && _p.CompanyId == _CompanyId
                                  && _s.Description == "Con cambios"
                                  select _s).ToList();
            bool _CheckStatusCambios = false;
            foreach (Status _pr in _ProductStatusCambios)
            {
                var _StatusId = (from _s in db.Status
                                 join _pe in db.ProductEditions
                                 on _s.StatusId equals _pe.StatusId
                                 where _pe.ProductId == c.prod.ProductId
                                 && _pe.EditionId == _EditionId
                                 select _s).ToList();
                foreach (var stat in _StatusId)
                {
                    if (stat.StatusId == _pr.StatusId)
                    {
                        _CheckStatusCambios = true;
                    }
                }
            }
            if (_ProductEditionsValue.LongCount() == 0)
            {
              @*<input disabled type="checkbox" id="@c.prod.ProductId" value="@c.prod.ProductId" name="Producto_Con_Cambios" class="Producto_Con_Cambios" checked="@_CheckStatusCambios">*@
            }
            else
            {
                     <input hidden value="@_ProductEditionsValue.SingleOrDefault().EditionId" id="_EditionIChanges" />
                <input type="checkbox" id="@c.prod.ProductId" value="@c.prod.ProductId" name="Producto_Con_Cambios" class="Producto_Con_Cambios" checked="@_CheckStatusCambios">
            }
}
                </td>
                <td align="center" class="Estilo2 btn-nav">
                    @{
                        <input type="hidden" value="@_EditionId" id="_EditionId" />
            var _ProductStatusSinCambios = (from _pe in db.ProductEditions
                                         join _p in db.Products
                                         on _pe.ProductId equals _p.ProductId
                                         join _s in db.Status
                                         on _pe.StatusId equals _s.StatusId
                                         where _pe.EditionId == pp.id
                                         && _p.CompanyId == _CompanyId
                                         && _s.Description == "Sin cambios"
                                         select _s).ToList();
            bool _CheckStatusSinCambios = false;
            foreach (Status _pr in _ProductStatusSinCambios)
            {
                var _StatusId = (from _s in db.Status
                                 join _pe in db.ProductEditions
                                 on _s.StatusId equals _pe.StatusId
                                 where _pe.ProductId == c.prod.ProductId
                                 && _pe.EditionId == _EditionId
                                 select _s).ToList();
                foreach (var stat in _StatusId)
                {
                    if (stat.StatusId == _pr.StatusId)
                    {
                        _CheckStatusSinCambios = true;
                    }
                }
            }
            if (_ProductEditionsValue.LongCount() == 0)
            {
             @*<input disabled type="checkbox" id="@c.prod.ProductId" value="@c.prod.ProductId" name="Producto_Sin_Cambios" class="Producto_Sin_Cambios" checked="@_CheckStatusSinCambios">*@
            }
            else
            {
                <input hidden value="@_ProductEditionsValue.SingleOrDefault().EditionId" id="_EditionIdNotChanges" />
    <input type="checkbox" id="@c.prod.ProductId" value="@c.prod.ProductId" name="Producto_Sin_Cambios" class="Producto_Sin_Cambios" checked="@_CheckStatusSinCambios">
            }
}
                </td>
                <td>
                    <div align="center">
                        <a class="btn btn-default loading" href="/Ventas/EditarProductos/@ViewData["Number"]/@c.prod.ProductId/@_Session1.ed" data-toggle="modal" data-target="#TTT" id="enlaceajax" title="Editar producto">
                            <i class="glyphicon glyphicon-pencil"></i>
                        </a>
                    </div>
                </td>
                <td>
                    <div align="center">
                        <a class="btn btn-primary loading" data-toggle="modal" data-target=".@c.prod.ProductId" title="Información del producto">
                            <i class="glyphicon glyphicon-info-sign"></i>
                        </a>
                    </div>
                </td>
                <td>
                    <div align="center">
                        <a class="btn btn-default loading btn-warning" data-toggle="modal" data-target="#@_m" title="Secciones asociadas al producto">
                            <i class="glyphicon glyphicon-indent-left"></i>
                        </a>
                    </div>
                </td>
                <td>
                    <div align="center">
                        <a class="btn btn-default loading btn-danger" data-toggle="modal" data-target="#@_r" title="Índices asociados al producto">
                            <i class="glyphicon glyphicon glyphicon-italic"></i>
                        </a>
                    </div>
                </td>
                <td>
                    <div align="center">
                        <a class="btn btn-default loading navbar-default btn-nav" data-toggle="modal" data-target="#@_n" title="Edición">
                            <i class="glyphicon glyphicon-indent-right"></i>
                        </a>
                    </div>
                </td>
            </tr>
        }
    </table>
</div>
<div align="center" class="Estilo4 btn-nav">
    Página @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) de @Model.PageCount
    <div align="center" class="Estilo4">
        @Html.PagedListPager(Model, page => Url.Action("Productos",
                    new { page, sortOrder = ViewBag.CurrentSort, currentFilter = ViewBag.CurrentFilter}))
    </div>
</div>
<div class="blockscreen" id="cargandoTiempo">
    <div id="blockmessage">
        <h3 style="color:#000" class="TextBlock">  Cargando... </h3>
    </div>
    <div id="blockimg">
        <img src="/Images/Timer.gif">
    </div>
</div>
<div class="container">
    @{
        using (Html.BeginForm())
        {
            <div class="modal modal-message modal-danger fade in" id="AgregarProductoId" role="dialog" data-keyboard="false" data-backdrop="static">
                <input type="hidden" value="@ViewData["CompanyId"]" id="_CompanyIdAdd" />
                <input type="hidden" value="@_Session1.id" id="_EditionIdAddProduct" />
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="text-danger">×</span><span class="sr-only">Close</span></button>
                            <div class="Estilo7 Estilo6 btn-nav" align="center">
                                Agregar producto
                            </div>
                        </div>
                        <div class="modal-body">
                            <div class="Nota btn-nav" align="right">
                                Nota: Los campos marcados con <strong class="Red">*</strong> son obligatorios.
                                <br />
                            </div>
                            <div class="Estilo7x btn-nav">
                                Nombre del producto: <strong class="Red">*</strong>
                                <input class="form-control btn-nav" id="_ProductNameAdd" type="text">
                            </div>
                            <div class="Estilo7x btn-nav">
                                Descripción:
                                <input class="form-control btn-nav" id="_DescriptionAdd" type="text">
                            </div>
                            <div class="Estilo7x btn-nav">
                                Tipo de producto: <strong class="Red">*</strong>
                                <select id="_ProductTypeIdAdd" class="form-control Estilo2x _TipodeProducto">
                                    <option value="@null">Seleccione...</option>
                                    @{
            var _ProductTypes = (from _pt in db.ProductTypes
                                 where _pt.Description != "MARCA"
                                 select _pt).ToList();
            foreach (var t in _ProductTypes)
            {
                            <option value="@t.ProductTypeId">@t.Description</option>
            }
                                    }
                                </select>

                            </div>
                            <div class="Estilo7x btn-nav" id="_ProductParent">
                                Producto asociado: <strong class="Red">*</strong>
                                <select id="_ProductIdParentAdd" class="form-control Estilo2x">
                                    <option value="@null">Seleccione...</option>
                                    @{
            var _ProductsTypess = (from _p in db.Products
                                   join _pe in db.ProductEditions
                                   on _p.ProductId equals _pe.ProductId
                                   join _pt in db.ProductTypes
                                   on _p.ProductTypeId equals _pt.ProductTypeId
                                   where _pt.Description != "(PRODUCTO) en TERCERA"
                                   && _pt.Description != "AGREGADO"
                                   && _pt.Description != "PRODUCTO (TEXTO EDITORIAL)"
                                   && _pt.Description != "MARCA"
                                   && _pe.EditionId == pp.id
                                   && _p.CompanyId == _Session1.ed
                                   select _p).ToList();
            foreach (var _p in _ProductsTypess)
            {
                        <option value="@_p.ProductId">@_p.ProductName</option>
            }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="modal-body" align="center">
                            <input type="button" value="Guardar" class="btn btn-success AgregarProducto Estilo2x" />
                            <input type="button" value="Cancelar" class="btn btn-default navbar-default btn-nav Estilo2x" data-dismiss="modal" />
                        </div>
                    </div>
                </div>
            </div>
        }
    }
</div>
    foreach (var c in Model)
    {
        <div class="modal modal-message modal-success fade @c.prod.ProductId">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div>
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="text-danger">×</span><span class="sr-only">Close</span></button>
                    </div>
                    <br />
                    <div class="modal-body1 Estilo2x">
                        <div>
                            <div class="panel panel-warning">
                                <div class="panel-body">
                                    <div>
                                        <div class="modal-header Estilo7 btn-nav" align="center">
                                            <h1 class="modal-title btn-nav Estilo7" id="myModalLabel">Información del producto</h1>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                                <div>
                                                    <br />
                                                    <table class="table table-hover table-bordered">
                                                        <tr>
                                                            <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                <div>
                                                                    <div align="right" class="btn-nav">  Nombre del producto: </div>
                                                                </div>
                                                            </td>
                                                            <td class="Estilo4">
                                                                <div>
                                                                    <div align="left" class="btn-nav">@c.prod.ProductName</div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                <div>
                                                                    <div align="right" class="btn-nav">  Descripción: </div>
                                                                </div>
                                                            </td>
                                                            <td class="Estilo4">
                                                                <div>
                                                                    <div align="left" class="btn-nav">@c.prod.Description</div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                <div>
                                                                    <div align="right" class="btn-nav">  Tipo de producto: </div>
                                                                </div>
                                                            </td>
                                                            <td class="Estilo4">
                                                                <div>
                                                                    <div align="left" class="btn-nav">@c.prodtypes.Description</div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        @{
        //var _Value = (from _p in db.Products
        //              join _pe in db.ProductEditions
        //              on _p.ProductId equals _pe.ProductId
        //              where _p.ProductId == c.prod.ProductIdParent
        //              && _pe.EditionId == _Session1.id
        //              orderby _p.ProductName
        //              select _p).ToList();
        var _ProductParents = (from _p in db.Products
                               where _p.ProductId == c.prod.ProductIdParent
                               select _p).ToList();
        if (_ProductParents.LongCount() > 0)
        {
            foreach (var f in _ProductParents)
            {
                <tr>
                    <td width="200" align="center" class="Estilo4 btn-nav warning">
                        <div>
                            <div align="right" class="btn-nav">  Producto asociado: </div>
                        </div>
                    </td>
                    <td class="Estilo4">
                        <div>
                            <div align="left" class="btn-nav">@f.ProductName</div>
                        </div>
                    </td>
                </tr>
            }
        }
                                                        }
                                                    </table>
                                                    @{
        var _ValueProductParent = (from _p in db.Products
                                   where _p.ProductId == c.prod.ProductId
                                   select _p).ToList();
        foreach (var _ProductParentValue in _ValueProductParent)
        {
            var _ProductParent = (from _p in db.Products
                                  where _p.ProductIdParent == _ProductParentValue.ProductId
                                  select _p).ToList();
            if (_ProductParent.LongCount() > 0)
            {
                <div>
                    <div class="Estilo4">
                        En la siguiente lista se muestran los productos que dependen de <strong class="Estilo6 btn-nav">@_ProductParentValue.ProductName</strong>
                    </div>
                </div>
                                                        <br />
                                                        <nav class="navbar navbar-default Estilo4  container center col-lg-5">
                                                            <div class="container-fluid">
                                                                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                                                                    <ul class="nav navbar-nav">
                                                                        <li class="dropdown  navbar-default">
                                                                            <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Productos dependientes<span class="caret"></span></a>
                                                                            <ul class="dropdown-menu v" role="menu">
                                                                                <li>
                                                                                    <div id="custom-search-input">
                                                                                        <div class="input-group col-md-11">
                                                                                            <input id="Caracter2" type="text" class="form-control btn-nav" placeholder="Buscar" />
                                                                                            <span class="input-group-btn">
                                                                                                <button class="btn btn-info" type="button">
                                                                                                    <i class="glyphicon glyphicon-search"></i>
                                                                                                </button>
                                                                                            </span>
                                                                                        </div>
                                                                                    </div>
                                                                                </li>
                                                                                <li>
                                                                                    <p> </p>
                                                                                </li>
                                                                                @foreach (var ss in _ProductParent)
                                                                                {
                                                                                    <li class="ListaProductos2"><a>@ss.ProductName</a></li>
                                                                                }
                                                                            </ul>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </nav>
            }
        }
                                                    }
                                                </div>
                                                <button1 class="Estilo2x btn btn-danger" data-dismiss="modal">Cerrar</button1>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <br />
                    </div>
                </div>
            </div>
        </div>
    }
<div class="container">
    @{
        foreach (var c in Model)
        {
            var _n = c.prod.ProductId + 10000;
            <div class="modal modal-message modal-success fade " id="@_n" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="text-danger">×</span><span class="sr-only">Close</span></button>
                        <div class="modal-body1 Estilo2x">
                            <br />
                            <div>
                                <div class="panel panel-warning">
                                    <div class="panel-body">
                                        <div>
                                            <div class="modal-header Estilo7 btn-nav" align="center">
                                                <h1 class="modal-title btn-nav Estilo7" id="myModalLabel">Ediciones en donde participa el producto</h1>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row">
                                                    <div>
                                                        <br />
                                                        <table class="table table-hover table-bordered">
                                                            <tr>
                                                                <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                    <div>
                                                                        <div align="right">  Nombre del producto: </div>
                                                                    </div>
                                                                </td>
                                                                <td class="Estilo4 btn-nav">
                                                                    <div>
                                                                        <div align="left">@c.prod.ProductName</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                    <div>
                                                                        <div align="right">  Descripción: </div>
                                                                    </div>
                                                                </td>
                                                                <td class="Estilo4 btn-nav">
                                                                    <div>
                                                                        <div align="left">@c.prod.Description</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                    <div>
                                                                        <div align="right">  Tipo de producto: </div>
                                                                    </div>
                                                                </td>
                                                                <td class="Estilo4 btn-nav">
                                                                    <div>
                                                                        <div align="left">@c.prodtypes.Description</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            @{
            //var _Value = (from _p in db.Products
            //              join _pe in db.ProductEditions
            //              on _p.ProductId equals _pe.ProductId
            //              where _p.ProductId == c.prod.ProductIdParent
            //              //&& _pe.EditionId == _Session1.id
            //              orderby _p.ProductName
            //              select _p).ToList();
            var _ProductParent = (from _p in db.Products
                                  where _p.ProductId == c.prod.ProductIdParent
                                  select _p).ToList();
            if (_ProductParent.LongCount() > 0)
            {
                foreach (var f in _ProductParent)
                {
                    <tr>
                        <td width="200" align="center" class="Estilo4 btn-nav warning">
                            <div>
                                <div align="right">  Producto asociado: </div>
                            </div>
                        </td>
                        <td class="Estilo4">
                            <div>
                                <div align="left">@f.ProductName</div>
                            </div>
                        </td>
                    </tr>
                }
            }
                                                            }
                                                        </table>
                                                        <div class="modal-body1">
                                                            <ul class="timeline">
                                                                @*<li>
                                                                        <div class="timeline-badge">
                                                                            <a title="Agregar" class="btn btn-success" href="/Ventas/AgregarProductoNuevaEdición/@ViewData["Number"]/@ViewData["CompanyId"]/@c.prod.ProductId/@_Session1._CompanyTypeId" data-toggle="modal" data-target="#TTT3" id="enlaceajax3">
                                                                                <i class="glyphicon glyphicon-plus"></i>
                                                                            </a>
                                                                        </div>
                                                                        <div class="timeline-panel">
                                                                            <div align="right" class="Estilo4 btn-nav modal-body"> Agregar producto a edición </div>
                                                                        </div>
                                                                    </li>*@
                                                                @{
            var _ProuctEditions = (from _pe in db.ProductEditions
                                   join _ed in db.Editions
                                   on _pe.EditionId equals _ed.EditionId
                                   where _pe.ProductId == c.prod.ProductId
                                   select new { _pe, _ed }).ToList();
            foreach (var s in _ProuctEditions)
            {
                <li class="timeline-inverted">
                    @*<div class="timeline-badge">
                            <a title="Desasociar producto" class="btn btn-danger GuardarCambios" onclick="location.href='@Url.Action("EliminarEdiciónProducto", "Ventas", new { id = @ViewData["Number"], EditionId = s._pe.EditionId, ProductId = s._pe.ProductId, CompanyId = @ViewData["CompanyId"], CompanyTypeId = _Session1._CompanyTypeId })';return false;">
                                <i class="glyphicon glyphicon glyphicon-remove"></i>
                            </a>
                            <a title="Editar" class="btn btn-default" href="/Ventas/EditarEdicionesParticipantesProducto/@ViewData["Number"]/@s._pe.EditionId/@s._pe.ProductId/@ViewData["CompanyId"]/@_Session1._CompanyTypeId" data-toggle="modal" data-target="#TTT2" id="enlaceajax2">
                                <i class="glyphicon glyphicon glyphicon-pencil"></i>
                            </a>
                        </div>*@
                    <div class="timeline-panel">
                        <div align="left" class="Estilo4 btn-nav modal-body"> DEACI <strong class="Estilo6"> @s._ed.NumberEdition </strong></div>
                        @{
                            var _ProductEditionsContent = (from _pe in db.ProductEditions
                                                               where _pe.EditionId == s._ed.EditionId
                                                               && _pe.ProductId == s._pe.ProductId
                                                               select _pe).ToList();
                            foreach (var a in _ProductEditionsContent)
                            {
                                if (a.HtmlContent == null)
                                {
                                                                <div class="Estilo4 Red">No hay contenido HTML</div>
                                }
                                else
                                {
                                                                     <div class="Estilo4">Contenido:<a href="/Ventas/HTMLProducts/@a.EditionId/@a.ProductId" target="_blank"> @a.HtmlFile</a></div>
                                }
                            }
                        }
                        <div align="left" class="Estilo4 btn-nav modal-body">
                            @*Contenido Html: <textarea class="form-control"> @s._pe.HtmlContent </textarea>*@
                        </div>
                    </div>
                </li>
            }
                                                                }
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <button1 class="Estilo2x btn btn-danger" data-dismiss="modal">Cerrar</button1>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br />
                        </div>
                    </div>
                </div>
            </div>
        }
    }
</div>
<div class="container">
    @{
        foreach (var c in Model)
        {
            var _m = c.prod.ProductId + 20000;
            <div class="modal modal-message modal-success fade " id="@_m" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="text-danger">×</span><span class="sr-only">Close</span></button>
                        <div class="modal-body1 Estilo2x">
                            <br />
                            <div>
                                <div class="panel panel-warning">
                                    <div class="panel-body">
                                        <div>
                                            <div class="modal-header Estilo7 btn-nav" align="center">
                                                <h1 class="modal-title btn-nav Estilo7" id="myModalLabel">Secciones asociadas al producto</h1>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row">
                                                    <div>
                                                        <br />
                                                        <table class="table table-hover table-bordered">
                                                            <tr>
                                                                <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                    <div>
                                                                        <div align="right" class="btn-nav"> Nombre del producto: </div>
                                                                    </div>
                                                                </td>
                                                                <td class="Estilo4">
                                                                    <div>
                                                                        <div align="left" class="btn-nav">@c.prod.ProductName</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                    <div>
                                                                        <div align="right" class="btn-nav"> Descripción: </div>
                                                                    </div>
                                                                </td>
                                                                <td class="Estilo4">
                                                                    <div>
                                                                        <div align="left" class="btn-nav">@c.prod.Description</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                    <div>
                                                                        <div align="right" class="btn-nav"> Tipo de producto: </div>
                                                                    </div>
                                                                </td>
                                                                <td class="Estilo4">
                                                                    <div>
                                                                        <div align="left" class="btn-nav">@c.prodtypes.Description</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                        <div class="modal-body1">
                                                            <img src="/Images/Sección.png" style="width:30%; height:30%;" class="img-circle" />
                                                            <ul class="timeline">
                                                                <li>
                                                                    <div hidden class="timeline-panel">
                                                                        <div align="right" class="Estilo4 btn-nav modal-body">
                                                                            Agregar producto a sección
                                                                        </div>
                                                                    </div>
                                                                </li>
                                                                <li>
                                                                    <div class="timeline-badge">
                                                                        <a title="Agregar" class="btn btn-success loading" href="/Ventas/AgregarSeccionesProducto/@c.prod.ProductId" data-toggle="modal" data-target="#AsociarProductosSecciónes" id="enlaceajaxSecciones">
                                                                            <i class="glyphicon glyphicon-plus"></i>
                                                                        </a>
                                                                    </div>
                                                                    <div class="timeline-panel">
                                                                        <div align="right" class="Estilo4 btn-nav modal-body"> Agregar producto a sección </div>
                                                                    </div>
                                                                </li>
                                                                @{
            var _Indexes = (from _p in db.Products
                            join _ps in db.ProductSections
                            on _p.ProductId equals _ps.ProductId
                            join _s in db.Sections
                            on _ps.SectionId equals _s.SectionId
                            where _p.ProductId == c.prod.ProductId
                            select new { _p, _ps, _s }).ToList();
            foreach (var s in _Indexes)
            {
                if (s._s.SectionIdParent == null)
                {
                    <li class="timeline-inverted">
                        <div class="timeline-badge">
                            <a title="Desasociar sección" class="btn btn-danger loading" onclick="_Eliminar_Sección_Producto(@s._s.SectionId, @s._p.ProductId)">
                                <i class="glyphicon glyphicon glyphicon-remove"></i>
                            </a>
                        </div>
                        <div class="timeline-panel">
                            <div align="left" class="Estilo4 modal-body">
                                <h4 class="Estilo6">(Sección)</h4>
                                <h4 class="btn-nav">
                                    @s._s.Description
                                </h4>
                            </div>
                        </div>
                    </li>
                }
                else
                {
                    var _sections = (from _s in db.Sections
                                     where _s.SectionId == s._s.SectionIdParent
                                     select _s).ToList();
                    <li>
                        <div class="timeline-badge">
                            <a class="btn btn btn-danger loading" onclick="_Eliminar_Sección_Producto(@s._s.SectionId, @s._p.ProductId)">
                                <span class="glyphicon glyphicon glyphicon-remove" aria-hidden="true"></span>
                            </a>
                        </div>
                        <div class="timeline-panel" align="left">
                            <div class="timeline-body">
                                @if (_sections.SingleOrDefault().SectionIdParent == null)
                                {
                                    <p class="Estilo4 btn-nav">
                                        <h4 class="Estilo6">(Sub Sección)</h4>
                                        <h4 class="btn-nav">@s._s.Description</h4>
                                    </p>
                                }
                                else
                                {
                                    <p class="Estilo4 btn-nav">
                                        <h4 class="Estilo6"> (Sub Sub Sección)</h4>
                                        <h4 class="btn-nav">@s._s.Description</h4>
                                    </p>
                                }
                                <a class="btn btn-nav">
                                    <i class="glyphicon glyphicon-arrow-down">
                                    </i>
                                </a>
                                @if (_sections.LongCount() > 0)
                                {
                                    foreach (var f in _sections)
                                    {
                                        if (f.SectionIdParent == null)
                                        {
                                            <p class="Estilo4 btn-nav">
                                                <h4 class="Estilo6">(Sección)</h4>
                                                <h4 class="btn-nav">@f.Description</h4>
                                            </p>
                                        }
                                        else
                                        {
                                            <p class="Estilo4 btn-nav">
                                                <h4 class="Estilo6">(Sub Sección)</h4>
                                                <h4 class="btn-nav">@f.Description</h4>
                                            </p>
                                            <a class="btn btn-nav">
                                                <i class="glyphicon glyphicon-arrow-down">
                                                </i>
                                            </a>
                                            var _Level = (from _s in db.Sections
                                                          where _s.SectionId == f.SectionIdParent
                                                          select _s).ToList();
                                            if (_Level.LongCount() > 0)
                                            {
                                                foreach (var d in _Level)
                                                {
                                                    <p class="Estilo4 btn-nav">
                                                        <h4 class="Estilo6">(Sección)</h4>
                                                        <h4 class="btn-nav">@d.Description </h4>
                                                    </p>
                                                }
                                            }
                                        }

                                    }
                                }
                            </div>
                        </div>
                    </li>
                }
            }
                                                                }
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <button1 class="Estilo2x btn btn-danger" data-dismiss="modal">Cerrar</button1>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br />
                        </div>
                    </div>
                </div>
            </div>
        }
    }
</div>
<div class="container">
    @{
        foreach (var c in Model)
        {
            var _r = c.prod.ProductId + 30000;
            <div class="modal modal-message modal-success fade " id="@_r" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="text-danger">×</span><span class="sr-only">Close</span></button>
                        <div class="modal-body1 Estilo2x">
                            <br />
                            <div>
                                <div class="panel panel-warning">
                                    <div class="panel-body">
                                        <div>
                                            <div class="modal-header Estilo7 btn-nav" align="center">
                                                <h1 class="modal-title btn-nav Estilo7" id="myModalLabel">Índices asociados al producto</h1>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row">
                                                    <div>
                                                        <br />
                                                        <table class="table table-hover table-bordered">
                                                            <tr>
                                                                <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                    <div>
                                                                        <div align="right"> Nombre del producto: </div>
                                                                    </div>
                                                                </td>
                                                                <td class="Estilo4">
                                                                    <div>
                                                                        <div align="left">@c.prod.ProductName</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                    <div>
                                                                        <div align="right"> Descripción: </div>
                                                                    </div>
                                                                </td>
                                                                <td class="Estilo4">
                                                                    <div>
                                                                        <div align="left">@c.prod.Description</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td width="200" align="center" class="Estilo4 btn-nav warning">
                                                                    <div>
                                                                        <div align="right"> Tipo de producto: </div>
                                                                    </div>
                                                                </td>
                                                                <td class="Estilo4">
                                                                    <div>
                                                                        <div align="left">@c.prodtypes.Description</div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                        <div class="modal-body1">
                                                            <img src="/Images/Índices.png" style="width:30%; height:30%;" class="img-circle" />
                                                            <ul class="timeline">
                                                                <li>
                                                                    <div hidden class="timeline-panel">
                                                                        <div align="right" class="Estilo4 btn-nav modal-body">
                                                                            Agregar producto a índice
                                                                        </div>
                                                                    </div>
                                                                </li>
                                                                <li>
                                                                    <div class="timeline-badge">
                                                                        <a title="Agregar" class="btn btn-success loading" href="/Ventas/AgregarÍndicesProducto/@c.prod.ProductId" data-toggle="modal" data-target="#AsociarÍndicesProducto" id="enlaceajaxÍndices">
                                                                            <i class="glyphicon glyphicon-plus"></i>
                                                                        </a>
                                                                    </div>
                                                                    <div class="timeline-panel">
                                                                        <div align="right" class="Estilo4 btn-nav modal-body"> Agregar producto a índice </div>
                                                                    </div>
                                                                </li>
                                                                @{
            var _Indexes = (from _p in db.Products
                            join _pi in db.ProductIndexes on _p.ProductId equals _pi.ProductId
                            join _ind in db.Indexes on _pi.IndexId equals _ind.IndexId
                            where _p.ProductId == c.prod.ProductId
                            select new { _p, _pi, _ind }).ToList();
            foreach (var s in _Indexes)
            {
                <li class="timeline-inverted">
                    <div class="timeline-badge">
                        <a title="Desasociar sección" class="btn btn-danger loading" onclick="_Eliminar_Índice_Producto(@s._ind.IndexId, @s._p.ProductId)">
                            <i class="glyphicon glyphicon glyphicon-remove"></i>
                        </a>
                    </div>
                    <div class="timeline-panel">
                        <div align="left" class="Estilo4 modal-body"> <h4 class="Estilo6">(Índice asociado)</h4> <h4 class="btn-nav"> @s._ind.Description</h4></div>
                    </div>
                </li>
            }
                                                                }
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <button1 class="Estilo2x btn btn-danger" data-dismiss="modal">Cerrar</button1>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <br />
                        </div>
                    </div>
                </div>
            </div>
        }
    }
</div>
<div class="modal modal-message modal-success fade in container col-lg-10" id="TTT" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg" id="destino">
        <div class="modal-content">
        </div>
    </div>
</div>
<div class="modal modal-message modal-success fade in container col-lg-10" id="TTT2" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg" id="destino2">
        <div class="modal-content">
        </div>
    </div>
</div>
<div class="modal modal-message modal-success fade in container col-lg-10" id="TTT3" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg" id="destino3">
        <div class="modal-content">
        </div>
    </div>
</div>
<div class="modal modal-message modal-success fade in container col-lg-10" id="AsociarProductosSecciónes" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg" id="destinoSecciones">
        <div class="modal-content">
        </div>
    </div>
</div>
<div class="modal modal-message modal-success fade in container col-lg-10" id="AsociarÍndicesProducto" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg" id="destinoÍndices">
        <div class="modal-content">
        </div>
    </div>
</div>
        }
    }
}


